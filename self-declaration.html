<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>UP स्वप्रमाणित घोषणा-पत्र</title>
  <style>
    body { font-family: "Noto Sans Devanagari", Mangal, "Arial Unicode MS", Arial, sans-serif; margin:0; background: #f5f6fa;}
    .container { max-width: 950px; margin: 15px auto; background:#fff; border-radius:8px; box-shadow:0 1px 6px #ccc; padding: 18px; }
    h2 { text-align:center; margin:0 0 20px 0;}
    .instructions {
      background: #e2fff5;
      padding: 9px 15px;
      border-radius: 5px;
      font-size: 15px;
      margin-bottom: 13px;
      line-height:1.7;
    }
    form { display:flex; flex-wrap:wrap; gap:13px; }
    .field { flex:1 0 260px; min-width:170px; }
    .field label { font-weight:600; display:block; margin-bottom:4px;}
    .field input, .field textarea {
      width: 98%; font-size:15px; padding:6.5px; border: 1px solid #bbb; border-radius: 4px; margin-bottom: 2px; background:#fafcff;}
    .field input[type="file"] { padding:3px;}
    #preview-signature { width:120px; margin:10px 0; display:none; border:1px solid #ddd; border-radius:3px;}
    .btn { background:#097671; color:#fff; border-radius:4px; border:0; padding:9px 18px; font-size:16px; cursor:pointer;}
    .btn:active { background:#064d4b; }
    .output-block { text-align:center; margin-top:22px;}
    #result-img { max-width:98%; border:1px solid #b8b8b8; margin-top:12px;}
    @media (max-width: 700px) {
      .container { max-width: 100vw; padding:5px; }
      .field { min-width:97vw; }
      label, .instructions { font-size:15px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>
      स्वप्रमाणित घोषणा-पत्र (Self Declaration Form – UP)<br>
      <span style="font-size:15.5px;color:#1a465c;">ऑनलाइन फॉर्म भरें, हिंदी-इंग्लिश, मोबाइल-फ्रेंडली</span>
    </h2>
    <div class="instructions">
      <b>निर्देश (Instructions):</b><br>
      1. सभी प्रविष्टियाँ (Name, पिता का नाम आदि) हिंदी/English में भरें।<br>
      2. हस्ताक्षर (Signature) JPG/PNG फ़ाइल अपलोड करें। सफेद बैकग्राउंड अपने-आप ट्रांसपेरेंट (हट) हो जाएगा।<br>
      3. "Generate & Download" बटन से इमेज (&lt;100KB) तुरंत डाउनलोड करें।
      <br>
      <span style="color:#a43;font-size:14px;">
        कृपया जानकारी ध्यानपूर्वक भरें! (Fill details correctly, it will be printed onto the official form.)
      </span>
    </div>
    <form id="declarationForm" autocomplete="off">
      <div class="field">
        <label>नाम (Name):</label>
        <input type="text" name="name" maxlength="45" required>
      </div>
      <div class="field">
        <label>पिता का नाम (Father's Name):</label>
        <input type="text" name="father" maxlength="45" required>
      </div>
      <div class="field">
        <label>आयु (Age):</label>
        <input type="number" name="age" min="1" max="120" required>
      </div>
      <div class="field">
        <label>व्यवसाय (Occupation):</label>
        <input type="text" name="occupation" maxlength="35" required>
      </div>
      <div class="field" style="flex-basis: 95%;">
        <label>निवासी/पूरा पता (Address):</label>
        <textarea name="address" rows="2" maxlength="85" required></textarea>
      </div>
      <div class="field">
        <label>स्थल (Place):</label>
        <input type="text" name="place" maxlength="35" required>
      </div>
      <div class="field">
        <label>दिनांक (Date):</label>
        <input type="date" name="date" required>
      </div>
      <div class="field">
        <label>हस्ताक्षर (Signature - JPG/PNG):<br><span style="font-weight:400;">(सफेद बैकग्राउंड हटेगा)</span></label>
        <input type="file" accept="image/png,image/jpeg" id="signatureInput" required>
        <img id="preview-signature" src="" alt="Signature Preview">
      </div>
      <div class="field">
        <label>आवेदक का नाम (Applicant Name):</label>
        <input type="text" name="applicant_name" maxlength="45" required>
      </div>
      <div style="flex-basis:100%;margin-top:13px;text-align:center;">
        <button class="btn" type="submit">Generate & Download</button>
      </div>
    </form>
    <div class="output-block" id="output" style="display: none;">
      <h3>डाउनलोड करें (Download):</h3>
      <a id="download-link" href="#" download="UP-Declaration.jpg" class="btn">Download Image</a>
      <div><img id="result-img" src=""></div>
    </div>
  </div>
<script>
let signatureImage=null;
function makeSignatureTransparent(file, callback) {
  const img = new Image(); img.onload = function() {
    const cv = document.createElement('canvas'), ctx = cv.getContext('2d');
    cv.width = img.width; cv.height = img.height;
    ctx.drawImage(img,0,0);
    let imgd = ctx.getImageData(0,0,cv.width,cv.height);
    let d = imgd.data;
    for(let i=0;i<d.length;i+=4) {
      if(d[i]>240 && d[i+1]>240 && d[i+2]>240){ d[i+3]=0; }
    }
    ctx.putImageData(imgd,0,0);
    callback(cv);
  }; img.src = URL.createObjectURL(file);
}
document.getElementById("signatureInput").addEventListener("change",function(e){
  const file = e.target.files[0];
  if(!file) return;
  makeSignatureTransparent(file, function(canvas){
    signatureImage=canvas;
    let el=document.getElementById('preview-signature');
    el.src=canvas.toDataURL();
    el.style.display="block";
  });
});

// Coordinates (provided by user) used below
function drawFormOnImage(ctx, fields, w, h) {
  ctx.font='19px "Noto Sans Devanagari", Mangal, "Arial Unicode MS", Arial, sans-serif';
  ctx.fillStyle="#191919";
  ctx.textBaseline="top";
  // Name [318, 566]
  ctx.fillText(fields.name, 316, 558);

  // Father Name [810, 559]
  ctx.fillText(fields.father, 808, 555);

  // Age [218, 618]
  ctx.fillText(fields.age, 218, 613);
  
  // Occupation [482, 613]
  ctx.fillText(fields.occupation, 482, 609);

  // Address [727, 617], wrap if long or use alternate if lines needed
  ctx.font='18px "Noto Sans Devanagari", Mangal, Arial, sans-serif';
  let addr = fields.address.trim();
  if(addr.length <= 38) {
    ctx.fillText(addr, 723, 610);
  } else {
    let first = addr.substring(0, 38), rest = addr.substring(38);
    ctx.fillText(first, 723, 610);
    ctx.fillText(rest, 166, 664); // extra details
  }

  ctx.font='19px "Noto Sans Devanagari", Mangal, Arial, sans-serif';
  // Place [240,1011]
  ctx.fillText(fields.place, 238, 1007);

  // Date [246,1064], convert to dd-mm-yyyy
  let dateStr = fields.date ? fields.date.split('-').reverse().join('-') : '';
  ctx.fillText(dateStr, 246, 1060);

  // Applicant Name [883,1060]
  ctx.fillText(fields.applicant_name, 883, 1054);

  // Signature [934,1004]
  if(signatureImage) {
    // Draw signature, scale into form's signature area (adjust width/height as needed)
    let sw=160, sh=45; // width/height of signature box (tune as needed)
    let aspect=signatureImage.width/signatureImage.height;
    if(aspect>sw/sh) sh=sw/aspect;
    else sw=sh*aspect;
    ctx.globalAlpha=0.94;
    ctx.drawImage(signatureImage, 927, 990, sw, sh);
    ctx.globalAlpha=1.0;
  }
}

document.getElementById("declarationForm").addEventListener('submit', function(e){
  e.preventDefault();
  if(!signatureImage){ alert("कृपया हस्ताक्षर अपलोड करें | Please upload signature."); return; }
  let f = {};
  for(const el of e.target.elements) if(el.name) f[el.name]=el.value;
  const img = new Image();
  img.onload = function(){
    const w=img.naturalWidth, h=img.naturalHeight;
    const c = document.createElement('canvas');
    c.width=w; c.height=h;
    const ctx = c.getContext('2d');
    ctx.drawImage(img,0,0,w,h);
    drawFormOnImage(ctx, f, w, h);
    let q=0.95, out=c.toDataURL('image/jpeg', q);
    while(out.length/1.38>100*1024 && q>0.40) {
      q-=0.08;
      out = c.toDataURL('image/jpeg',q);
    }
    document.getElementById("output").style.display="block";
    document.getElementById("download-link").href = out;
    document.getElementById("result-img").src = out;
  };
  img.onerror = function() {
    alert('⚠️ फॉर्म टेम्पलेट इमेज लोड नहीं हो पाई!\nCheck this path:\nhttps://adityawebtech.github.io/url-shortner/sdf.jpg');
  };
  img.src = "https://adityawebtech.github.io/url-shortner/sdf.jpg";
});
document.getElementById('declarationForm').addEventListener('input', function(){
  document.getElementById("output").style.display="none";
});
</script>
</body>
</html>
